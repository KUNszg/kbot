<!DOCTYPE html>
<html lang="en">
    <head>
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-158909830-3"></script>
        <link rel="stylesheet" type="text/css" href="https://kunszg.xyz/style.css">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="icon" type="image/png" href="https://i.imgur.com/Tyf3qyg.gif"/>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'UA-158909830-3');
        </script>
        <style type="text/css">
            .container {
                position: relative;
                background-color: #2e2e2e;
            }

            .topright {
                position: absolute;
                top: -28px;
                right: 16px;
                color: white;
                font-family: 'Source Sans Pro', 'sans-serif';
            }

            .redDot {
                background-color: darkred;
                height: 10px;
                width: 10px;
                border-radius: 50%;
                display: inline-block;

            }

            .greenDot {
                background-color: darkgreen;
                height: 10px;
                width: 10px;
                border-radius: 50%;
                display: inline-block;
            }
        </style>
    </head>
    <meta charset="utf-8">
    <title>KUNszg</title>
    <body onload="myFunction()" class="bd">
        <div id="sideNav" class="sidenav">
            <a href="javascript:void(0)" class="closebtn"  onclick="closeNav()">&times;</a>
            <div id="box" style="margin-left: 20px; text-align: center;"></div>
        </div>
        <br>
        <span class="animate-bottom" style="font-size:20px; cursor:pointer; color:white; margin-left: 15px;" onclick="openNav()">&#9776; <a style="font-size: 20px;  font-family: 'Source Sans Pro', 'sans-serif';" >CHANNELS</a></span>

        <script type="text/javascript">
            if( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ) {

            } else {
                fetch('https://kunszg.xyz/api/stats')
                    .then(response => response.json())
                    .then(data => {

                        const secondsToDhms = (seconds) => {
                            seconds = Number(seconds);
                            const d = Math.floor(seconds / (3600*24));
                            const h = Math.floor(seconds % (3600*24) / 3600);
                            const m = Math.floor(seconds % 3600 / 60);
                            const s = Math.floor(seconds % 60);

                            const dDisplay = d > 0 ? d + "d " : "";
                            const hDisplay = h > 0 ? h + "h " : "";
                            const mDisplay = m > 0 ? m + "m " : "";
                            const sDisplay = s > 0 ? s + "s " : "";
                            return dDisplay + hDisplay + mDisplay + sDisplay;
                        }

                        let botUptime = Math.trunc((Date.now() - data.bot.codeUptime)/1000);

                        let [loggerUptime, remindersUptime, apiUptime, botUptime] = [
                            Math.trunc((Date.now() - data.modules.loggerLastSeen)/1000),
                            Math.trunc((Date.now() - data.modules.remindersLastSeen)/1000),
                            Math.trunc((Date.now() - data.modules.apiLastSeen)/1000),
                            Math.trunc((Date.now() - data.modules.botLastSeen)/1000)
                            ]

                        const spreadNumbers = (input) => {
                            return input.toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ")
                        }

                        const updateStats = () => {
                            botUptime += 1

                            const botMeter = `
                                <table style="font-size: 13px;">
                                    <tr>
                                        <th></th>
                                        <th></th>
                                    </tr>
                                    <tr>
                                        <td style="font-style: italic;">my stream is currently </td>
                                        <td style="padding:0 15px;">${data.twitch.isAuthoLive ? "live" : "offline"}</td>
                                    </tr>
                                    <tr>
                                        <td style="font-style: italic;">bot uptime </td>
                                        <td style="padding:0 15px;">${botUptime > 70 ? '<span title="offline" class="redDot"></span>' : secondsToDhms(botUptime)}</td>
                                    </tr>
                                    <tr>
                                        <td style="font-style: italic;">total users tracked </td>
                                        <td style="padding:0 15px;">${spreadNumbers(data.bot.usersLogged)}</td>
                                    </tr>
                                    <tr>
                                        <td style="font-style: italic;">command executions </td>
                                        <td style="padding:0 15px;">${spreadNumbers(data.bot.commandExecutions)}</td>
                                    </tr>
                                    <tr>
                                        <td style="font-style: italic;">commits </td>
                                        <td style="padding:0 15px;">${spreadNumbers(data.github.commits)}</td>
                                    </tr>
                                    <tr>
                                        <td style="font-style: italic;">logger </td>
                                        <td style="padding:0 15px;">${loggerUptime > 70 ? '<span title="offline" class="redDot"></span>' : '<span title="online" class="greenDot"></span>'}</td>
                                    </tr>
                                    <tr>
                                        <td style="font-style: italic;">reminders </td>
                                        <td style="padding:0 15px;">${remindersUptime > 70 ? '<span title="offline" class="redDot"></span>' : '<span title="online" class="greenDot"></span>'}</td>
                                    </tr>
                                    <tr>
                                        <td style="font-style: italic;">API </td>
                                        <td style="padding:0 15px;">${apiUptime > 70 ? '<span title="offline" class="redDot"></span>' : '<span title="online" class="greenDot"></span>'}</td>
                                    </tr>
                                </table>
                                `;

                            document.getElementById("stats").innerHTML = botMeter;
                        }

                        updateStats();

                        setInterval(() => {
                            updateStats();
                        }, 1000);
                    });
                }
        </script>

        <div class="container">
            <div class="topright" id="stats">
            </div>
        </div>

        <script>
            const openNav = () => {
                document.getElementById("sideNav").style.width = "230px";
            }

            const closeNav = () => {
                document.getElementById("sideNav").style.width = "0";
            }
        </script>
        <div id="loader"></div>

        <div style="display:none;" id="myDiv" class="animate-bottom">
            <script>
                var myVar;

                const myFunction = () => {
                    myVar = setTimeout(showPage, 1);
                }

                const showPage = () => {
                    document.getElementById("loader").style.display = "none";
                    document.getElementById("myDiv").style.display = "block";
                }
            </script>
            <div style="margin-top: 10%; vertical-align: middle; white-space: nowrap;">
                <h1 class="inner" style="margin-left: -3px;">
                    <a href="https://www.twitch.tv/kunszg" style="text-decoration: none;" class="button1">KUNszg</a>
                </h1>
                <div class="animate-bottom">
                    <a class="github" href="https://github.com/KUNszg/kbot" target="_blank">
                        <button style="margin-left: 20px;" class="button button1">
                            <div class="button1">
                                <pre style="margin-bottom:17px">GITHUB</pre>
                                <img class="res" src="img\logo.png">
                            </div>
                        </button>
                    </a>
                    <a class="commands" href="commands" target="_self">
                        <button class="button button1">
                            <div class="button1">
                                <pre style="margin-bottom:17px">COMMANDS</pre>
                                <img class="res" src="img\commands.png">
                            </div>
                        </button>
                    </a>
                    <a class="commands" href="emotes" target="_self">
                        <button class="button button1">
                            <div class="button1">
                                <pre style="margin-bottom:17px;">EMOTES</pre>
                                <img class="res" src="img\emotes.png">
                            </div>
                        </button>
                    </a>
                    <a class="commands" href="api" target="_self" style="margin-left: 12px;">
                        <button class="button button1">
                            <div class="button1">
                                <pre style="margin-bottom:17px">API</pre>
                                <img class="res" src="img\api.png">
                            </div>
                        </button>
                    </a>
                    <a class="commands" href="spotify" target="_self">
                        <button class="button button1" style="margin-left: 12px;">
                            <div class="button1">
                                <pre style="margin-bottom:17px">SPOTIFY</pre>
                                <img class="res" src="img\spotify.png">
                            </div>
                        </button>
                    </a>
                </div>
            </div>
        </div>
        <script type="text/javascript">
            fetch('https://kunszg.xyz/api/channels')
              .then(response => response.json())
              .then(rows => {
                var html = "<table><td style='color: green; border-bottom: solid dimgray 1px; font-weight: bold;'></td>";
                for (var i = 0; i < rows.data.length; i++) {
                    html+="<tr>";
                    html+="<td class='api'><a style='font-size: 15px;' href='https://twitch.tv/"+rows.data[i]+"'/>"+rows.data[i]+"</td>";

                    html+="</tr>";
                }
                html+="</table><br><br><br><br>";
                document.getElementById("box").innerHTML = html;
            })
        </script>
    </body>
</html>
