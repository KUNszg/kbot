<!DOCTYPE html >
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <link rel="stylesheet" type="text/css" href="https://kunszg.com/style.css">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="icon" type="image/png" href="https://i.imgur.com/Tyf3qyg.gif"/>
    </head>
    <meta charset="utf-8">
    <meta property="og:url" content="https://kunszg.com" />
    <meta property="og:url" content="https://kunszg.com/" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://i.nuuls.com/B320I.jpeg" />
    <meta name="description" content="Website for my dank bot - kunszgbot" />
    <style type="text/css">
        .dropdown {
          position: relative;
          display: inline-block;
        }

        .dropdown-content {
          display: none;
          background-color: none;
          border: none;
          overflow: auto;
          box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
          z-index: 1;
          position: absolute;
        }

        .dropdown-content a {
          line-height: 8px;
          font-size: 17px;
          color: white;
          padding: 1px 15px;
          text-decoration: none;
          display: block;
        }

        .show {display: block; }

        .select:hover {
            background-color: #262626;
            text-align: center;

        }
    </style>
    <title>KUNszg</title>
    <body onload="slideUp()" class="bd">
        <div id="sideNav" class="sidenav">
            <a href="javascript:void(0)" class="closebtn"  onclick="closeNav()">&times;</a>
            <div id="box" style="margin-left: 20px; text-align: center;"></div>
        </div>
        <br>
        <span class="animate-bottom channels-button" style="margin-left: 1.5vw;" onclick="openNav()">&#9776;
            <a style="font-size: 20px;" >CHANNELS</a>
        </span>

        <script type="text/javascript">
            if( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ) {
            } else {
                fetch('https://kunszg.com/api/stats')
                    .then(response => response.json())
                    .then(data => {

                        const secondsToDhms = (seconds) => {
                            seconds = Number(seconds);
                            const d = Math.floor(seconds / (3600*24));
                            const h = Math.floor(seconds % (3600*24) / 3600);
                            const m = Math.floor(seconds % 3600 / 60);
                            const s = Math.floor(seconds % 60);

                            const dDisplay = d > 0 ? d + "d " : "";
                            const hDisplay = h > 0 ? h + "h " : "";
                            const mDisplay = m > 0 ? m + "m " : "";
                            const sDisplay = s > 0 ? s + "s " : "";
                            return dDisplay + hDisplay + mDisplay + sDisplay;
                        }

                        let botUptime = Math.trunc((Date.now() - data.bot.codeUptime)/1000);

                        let [loggerUptime, remindersUptime, apiUptime, botAlive] = [
                            Math.trunc((Date.now() - data.modules.loggerLastSeen)/1000),
                            Math.trunc((Date.now() - data.modules.remindersLastSeen)/1000),
                            Math.trunc((Date.now() - data.modules.apiLastSeen)/1000),
                            Math.trunc((Date.now() - data.modules.botLastSeen)/1000)
                            ]

                        const spreadNumbers = (input) => {
                            return input.toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ")
                        }

                        const updateStats = () => {
                            botUptime += 1

                            const botMeter = `
                                <table style="font-size: 13px; margin-right: -1.2vw;">
                                    <colgroup>
                                        <col>
                                        <col style="width: 115px;">
                                    </colgroup>
                                    <tr>
                                        <td style="font-style: italic;">my stream is currently </td>
                                        <td style="padding:0 15px;">${data.twitch.isAuthoLive ? "live" : "offline"}</td>
                                    </tr>
                                    <tr>
                                        <td style="font-style: italic;">total users tracked </td>
                                        <td style="padding:0 15px;">${spreadNumbers(data.bot.usersLogged)}</td>
                                    </tr>
                                    <tr>
                                        <td style="font-style: italic;">command executions </td>
                                        <td style="padding:0 15px;">${spreadNumbers(data.bot.commandExecutions)}</td>
                                    </tr>
                                    <tr>
                                        <td style="font-style: italic;">commits </td>
                                        <td style="padding:0 15px;">${spreadNumbers(data.github.commits)}</td>
                                    </tr>
                                    <tr>
                                        <td style="font-style: italic;">bot uptime </td>
                                        <td style="padding: 0 15px;">${data.bot.isRestarting ? 'ðŸ”„ restarting' : secondsToDhms(botUptime)}</td>
                                    </tr>
                                    <tr>
                                        <td style="font-style: italic;">logger </td>
                                        <td style="padding:0 15px;">${loggerUptime > 70 ? '<span title="offline" class="redDot"></span>' : '<span title="online" class="greenDot"></span>'}</td>
                                    </tr>
                                    <tr>
                                        <td style="font-style: italic;">reminders </td>
                                        <td style="padding:0 15px;">${remindersUptime > 70 ? '<span title="offline" class="redDot"></span>' : '<span title="online" class="greenDot"></span>'}</td>
                                    </tr>
                                    <tr>
                                        <td style="font-style: italic;">API </td>
                                        <td style="padding:0 15px;">${apiUptime > 70 ? '<span title="offline" class="redDot"></span>' : '<span title="online" class="greenDot"></span>'}</td>
                                    </tr>
                                    <tr>
                                        <td style="font-style: italic;">API </td>
                                        <td style="padding:0 15px;">${apiUptime > 70 ? '<span title="offline" class="redDot"></span>' : '<span title="online" class="greenDot"></span>'}</td>
                                    </tr>
                                </table>
                                `;

                            document.getElementById("stats").innerHTML = botMeter;
                        }
                        updateStats();

                        setInterval(() => {
                            updateStats();
                        }, 1000);
                    });
                }
        </script>

        <div class="container">
            <div class="topright" id="stats">
            </div>
        </div>

        <script>
            const openNav = () => {
                document.getElementById("sideNav").style.width = "230px";
            }

            const closeNav = () => {
                document.getElementById("sideNav").style.width = "0";
            }
        </script>
        <div id="loader"></div>

        <div style="display:none;" id="myDiv" class="animate-bottom">
            <script>
                var myVar;

                const slideUp = () => {
                    myVar = setTimeout(showPage, 1);
                }

                const showPage = () => {
                    document.getElementById("loader").style.display = "none";
                    document.getElementById("myDiv").style.display = "block";
                }
            </script>
            <div style="margin-top: 10%; vertical-align: middle; white-space: nowrap;">
                <h1 class="inner" style="margin-left: -3px;">
                    <a href="https://www.twitch.tv/kunszg" style="text-decoration: none;" class="button1">KUNszg</a>
                </h1>
                <div class="animate-bottom">
                    <div class="dropdown">
                        <button style="margin-left: 20px;" onclick="drop()" class="button button1 dropbtn">
                            <pre style="margin-bottom:17px">PROJECTS</pre>
                            <img class="res" src="img\logo.png">
                            <div id="dropdwn" class="dropdown-content">
                                <a class="github select" target="_blank" href="https://github.com/KUNszg/kbot">
                                    <pre style="margin-bottom:17px">KUNSZGBOT</pre>
                                </a>
                                <a class="github select" target="_blank" href="https://github.com/KUNszg/vypyr-connector">
                                    <pre style="margin-bottom:17px">VYPYR-CONNECTOR</pre>
                                </a>
                            </div>
                        </button>
                    </div>
                    <a class="commands" href="commands" target="_self">
                        <button class="button button1">
                            <div class="button1">
                                <pre style="margin-bottom:17px">COMMANDS</pre>
                                <img class="res" src="img\commands.png">
                            </div>
                        </button>
                    </a>
                    <a class="commands" href="emotes" target="_self">
                        <button class="button button1">
                            <div class="button1">
                                <pre style="margin-bottom:17px;">EMOTES</pre>
                                <img class="res" src="img\emotes.png">
                            </div>
                        </button>
                    </a>
                    <a class="commands" href="api" target="_self" style="margin-left: 12px;">
                        <button class="button button1">
                            <div class="button1">
                                <pre style="margin-bottom:17px">API</pre>
                                <img class="res" src="img\api.png">
                            </div>
                        </button>
                    </a>
                    <a class="commands" href="connections" target="_self">
                        <button class="button button1" style="margin-left: -13px;">
                            <div class="button1">
                                <pre style="margin-bottom: 17px">CONNECTIONS</pre>
                                <img class="res" src="img\spotify.png">
                            </div>
                        </button>
                    </a>
                </div>
            </div>
        </div>
        <script type="text/javascript">
            function drop() {
                document.getElementById("dropdwn").classList.toggle("show");
            }

            // Close the dropdown if the user clicks outside of it
            window.onclick = function(event) {
                if (!event.target.matches('.dropbtn')) {
                    let dropdowns = document.getElementsByClassName("dropdwn-content");
                    for (let i = 0; i < dropdowns.length; i++) {
                        let openDropdown = dropdowns[i];

                        if (openDropdown.classList.contains('show')) {
                            openDropdown.classList.remove('show');
                        }
                    }
                }
            }

            fetch('https://kunszg.com/api/channels')
              .then(response => response.json())
              .then(rows => {
                var html = "<table><td style='color: green; border-bottom: solid dimgray 1px; font-weight: bold;'></td>";
                for (var i = 0; i < rows.data.length; i++) {
                    html+="<tr>";
                    html+="<td class='api'><a style='font-size: 15px;' href='https://twitch.tv/"+rows.data[i]+"'/>"+rows.data[i]+"</td>";

                    html+="</tr>";
                }
                html+="</table><br><br><br><br>";
                document.getElementById("box").innerHTML = html;
            })
        </script>
    </body>
</html>
